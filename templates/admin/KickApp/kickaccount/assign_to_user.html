{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_list %}

{% block extrastyle %}
  {{ block.super }}
  <link rel="stylesheet" type="text/css" href="{% static "admin/css/changelists.css" %}">
{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% translate 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {% translate 'Assign to User' %}
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    {% if messages %}
    <ul class="messagelist">
        {% for message in messages %}
        <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    
    <div class="module aligned">
        <h2>{{ title }}</h2>
        
        <div class="description">
            <p>Выбрано аккаунтов: <strong>{{ queryset.count }}</strong></p>
        </div>
        
        <form method="post" action="{% url opts|admin_urlname:'changelist' %}">
            {% csrf_token %}
            <input type="hidden" name="action" value="assign_to_user_action" />
            <input type="hidden" name="apply" value="1" />
            {% for account in queryset %}
                <input type="hidden" name="_selected_action" value="{{ account.id }}" />
            {% endfor %}
            <div class="form-row">
                <div>
                    <label for="user">Выберите пользователя:</label>
                    <select name="user" id="user" required>
                        <option value="">---------</option>
                        {% for user in users %}
                            <option value="{{ user.id }}">{{ user.username }} ({{ user.get_full_name|default:user.email }})</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="submit-row">
                <input type="submit" name="apply" value="Назначить аккаунты" class="default" />
                <a href="{% url opts|admin_urlname:'changelist' %}" class="closelink">Отмена</a>
            </div>
        </form>
        
        {% if queryset %}
        <div class="results">
            <h3>Выбранные аккаунты:</h3>
            <table>
                <thead>
                    <tr>
                        <th>Логин</th>
                        <th>Статус</th>
                        <th>Прокси</th>
                    </tr>
                </thead>
                <tbody>
                    {% for account in queryset %}
                    <tr>
                        <td>{{ account.login }}</td>
                        <td>{{ account.get_status_display }}</td>
                        <td>{{ account.proxy }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %} 