Check out our new search tool Ossity It's a web research hub that offers comparitive searches across 25 search engines. And it's free to use!

This page has been Textised!

The original page address was https://wiki.fromregion.xyz/books/webstreams/page/setup
For sharing use ...
Here are some options:

Back to original page (in this window | in a new window)
Print this page
Textise Home Page
Textise Options Page (choose font size, font colour, etc.)
Contact Subjunctive Software
Are you a webmaster? Find out how to easily add Textise to your web site.

Skip to main content
[Image: Logo]

WIKI Fromregion
Search Shelves Books Log in
Page Navigation
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥ AlmaLinux-9
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –°–£–ë–î Postgresql
1.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
1.2 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ postgresql
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
Book Navigation
WebStreams
Setup
Books
WebStreams
Setup
Setup –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–¥ AlmaLinux-9 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –°–£–ë–î Postgresql 1.1 –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤
sudo dnf update -y && sudo dnf install curl vim wget -y
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ RPM —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
sudo dnf install -y https://download.postgresql.org/pub/repos/yum/reporpms/EL-9-x86_64/pgdg-redhat-repo-latest.noarch.rpm
–û—Ç–∫–ª—é—á–∏—Ç—å –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å PostgreSQL
sudo dnf -qy module disable postgresql
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL
sudo dnf install -y postgresql15-server
–í–∫–ª—é—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl enable --now postgresql-15
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
systemctl status postgresql-15
1.2 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ postgresql
–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ posgresql
sudo su - postgres && psql
–°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
CREATE DATABASE <database-name>;
–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE USER <user> WITH PASSWORD '<PASSWORD>';
–í—ã–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ë–î
GRANT ALL PRIVILEGES ON DATABASE <database-name> to <user>;
–°–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –≤ pg_hba.conf
nano /var/lib/pgsql/15/data/pg_hba.conf
–ü–æ–¥ —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π:

# TYPE  DATABASE        USER            ADDRESS                 METHOD
–î–æ–±–∞–≤–∏—Ç—å —ç—Ç—É –∏–∑–º–µ–Ω–∏–≤ –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è:

<ip-address> - –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç–æ–∏—Ç –ø—Ä–æ–µ–∫—Ç

host    <database-name>	<user>         <ip-address>/<mask>           scram-sha-256
–î–ª—è –≤—Å—Ç—É–ø–ª–µ–Ω–∏—è –≤ —Å–∏–ª—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
systemctl restart postgresql
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Redis
–£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo dnf install redis -y
–ù–∞—Å—Ç—Ä–æ–π–∫–∞
–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ

sudo nano /etc/redis/redis.conf
2.1. –ò–∑–º–µ–Ω–∏—Ç—å –∞–¥—Ä–µ—Å –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è

bind 0.0.0.0
2.2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Redis

requirepass <your-password>
–í–∫–ª—é—á–µ–Ω–∏–µ
sudo systemctl enable --now redis
3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º Python 3.12.0 –∏–ª–∏ –≤—ã—à–µ

–°–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: 1.1. –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞:
python3 -m venv /.venv
1.2. –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

source ./venv/bin/activate
1.3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:

pip install -r ./requirements.txt
–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ (—Ñ–∞–π–ª ./Django/settings.py):
2.1. –ò–∑–º–µ–Ω–∏—Ç—å –º–∞—Å—Å–∏–≤ ALLOWED_HOSTS:

–ü—Ä–∏–º–µ—Ä:
ALLOWED_HOSTS = ['127.0.0.1', '0.0.0.0', 'example.com']
2.2. –ò–∑–º–µ–Ω–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å DATABASES:

–ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ postgresql

–ü—Ä–∏–º–µ—Ä:
DATABASES = {
    'default': {
        'ENGINE': "django.db.backends.postgresql",
        'NAME': "<database-name>",
        'USER': "<user>",
        'PASSWORD': "<password>",
        'HOST': "127.0.0.1",
        'PORT': "5432"
    }
}
2.3. –ò–∑–º–µ–Ω–∏—Ç—å –º–∞—Å—Å–∏–≤ CSRF_TRUSTED_ORIGINS:

–ü—Ä–∏–º–µ—Ä:
CSRF_TRUSTED_ORIGINS = [
    "http://127.0.0.1/",
    "http://127.0.0.1:8000/login",
    "https://example.com",
    "https://example.com/login"
]
2.4. –ò–∑–º–µ–Ω–∏—Ç—å —Å–ª–æ–≤–∞—Ä—å CHANNELS_LAYERS

–ó–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –≤ Redis

CHANNELS_LAYERS = {
  'default': {
    'BACKEND': 'channels_redis.core.RedisChannelLayer',
    'CONFIG': {
        "hosts": [
          'redis://<PASSWORD>@<IP>:6379'
        ],
    },

    # 'BACKEND': 'channels.layers.InMemoryChannelLayer'
  }
}
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –ë–î:
3.1. –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

python3 manage.py delete_migrations
3.2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

python3 manage.py makemigrations
3.3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –ë–î:

python3 manage.py migrate
–°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç–∏–∫—É:
python3 manage.py collectstatic --noinput --clear
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞
–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–∞ nano /etc/systemd/system/web-streams.service:
nano /etc/systemd/system/web-streams.service
–°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É ssl –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –Ω–µ–µ cert.pem –∏ privkey.pem –æ—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞.

–ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–∞–π–ª —Å–µ—Ä–≤–∏—Å–∞:
[Unit]
Description=Start WebChat
After=network.target

[Service]
User=root
Group=root
ExecStart=/bin/sh -c 'cd /opt/web-streams/ && source .venv/bin/activate && daphne -e ssl:8001:privateKey=ssl/privkey.pem:certKey=ssl/cert.pem Django.asgi:application -b 0.0.0.0'
Restart=always
KillSignal=SIGINT

[Install]
WantedBy=multi-user.target
–ò–∑–º–µ–Ω–∏—Ç—å –ø—É—Ç—å /opt/web-streams/ –Ω–∞ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –∫–æ—Ä–Ω—é –ø—Ä–æ–µ–∫—Ç–∞

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–µ–º–æ–Ω systemd:
systemctl daemon-reload
–í–∫–ª—é—á–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–º–æ–Ω web-streams:
sudo systemctl enable --now web-streams
5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞
–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä Nginx
sudo dnf install nginx -y
–í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞
sudo systemctl enable nginx
–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ —Å "üëàüëàüëà"

nano /etc/nginx/nginx.conf
–§–∞–π–ª:

user nginx;
worker_processes auto;

error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

include /usr/share/nginx/modules/*.conf;

events {
    worker_connections 1024;
    multi_accept on;
}

http {
  client_max_body_size 100M;
  include       mime.types;
  default_type  application/octet-stream;

  tcp_nodelay on;
  tcp_nopush on;

  sendfile on;
  sendfile_max_chunk 1m;
  keepalive_requests 100;
  keepalive_timeout 60;
  types_hash_max_size 4096;

  open_file_cache max=200000 inactive=20s;
  open_file_cache_valid 60m;
  open_file_cache_min_uses 1;
  open_file_cache_errors on;

  reset_timedout_connection on;
  client_body_timeout 10;
  send_timeout 5;

  gzip on;
  gzip_static on;
  gzip_comp_level 9;
  gzip_types text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript application/javascript text/babel;
  gzip_proxied any;
  gzip_buffers 16 8k;
  gzip_http_version 1.1;

  server {
    access_log off;

    listen 80;
    listen [::]:80;

    server_name <EXTERNAL-FQDN>; # üëàüëàüëà
    charset utf8;
    autoindex off;

    set $project_home /opt/web-streams; # üëàüëàüëà

    location /static/ {
      root /opt/web-streams; # üëàüëàüëà –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É
      add_header Cache-Control public;
      expires 1y;
    }

    location /opt/web-streams/media { # üëàüëàüëà –ê–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É/media
      autoindex on;
      alias /media;
      add_header Cache-Control public;
      expires 1y;
    }

    location / {
      proxy_pass http://0.0.0.0:8000; # daphne address

      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $host;

      proxy_read_timeout 300;
      proxy_connect_timeout 30;

      proxy_http_version 1.1;
    }

    location /ws-twitch/ {
        proxy_pass https://0.0.0.0:8001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }

    location @<project> {
      proxy_pass http://0.0.0.0:8000; # daphne address
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Host $server_name;
    }
  }
}
–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl restart nginx
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞
sudo systemctl restart web-streams && sudo systemctl status web-streams
Details
Revision #13
Created 3 days ago by evgeniymalyh
Updated 2 days ago by evgeniymalyh
Book Permissions Active
Page Permissions Active
Actions
Revisions
Export
Contained Web File.html
PDF File.pdf
Plain Text File.txt
Markdown File.md
Back to top

Textise: Back to top

This text-only page was created by Textise (www.textise.net) ¬© Subjunctive Software
To find out more about our product, visit textise.wordpress.com.